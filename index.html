<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Velkzie Music Player</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
  <style>
    :root { color-scheme: dark; }
    body, html { margin: 0; padding: 0; overflow: hidden; background: #0a0a0a; }
    .btn-control {
      background: linear-gradient(270deg, #7e22ce, #9333ea, #a855f7);
      background-size: 600% 600%;
      color: white; border: none; border-radius: 1rem;
      padding: 0.75rem 1rem; font-size: 1.25rem;
      animation: gradientMove 6s ease infinite;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn-control:hover { box-shadow: 0 0 15px rgba(168,85,247,.8); transform: scale(1.05); }
    @keyframes gradientMove { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .pill { padding: .35rem .6rem; border-radius: .75rem; background: #1f1f23; }
    .pill:hover { background:#2a2a30; }
    .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 50; background: rgba(0,0,0,.6); }
    .modal.open { display:flex; }
    #player { position: relative; width: 100%; padding-bottom: 56.25%; height: 0; margin-top: 1rem; border-radius: 1rem; overflow: hidden; background: #000; }
    #player iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    #lyricsPanel, #queuePanel { transition: all .4s ease; z-index: 20; }
    #lyricsPanel { position: fixed; top:0; right:-420px; width:380px; height:100%; background:rgba(20,20,30,0.95); border-left:2px solid #4b0082; overflow-y:auto; padding:1rem; }
    #lyricsPanel.open { right:0; }
    #queuePanel { position:fixed; top:0; left:-420px; width:380px; height:100%; background:rgba(20,20,20,0.95); border-right:2px solid #333; overflow-y:auto; padding:1rem; }
    #queuePanel.open { left:0; }
    .lyric-line { margin-bottom:.35rem; padding:.35rem .5rem; border-radius:.5rem; background:rgba(255,255,255,.05); }
    .lyric-active { background:rgba(168,85,247,.25); box-shadow:0 0 10px rgba(168,85,247,.6); }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100 min-h-screen relative">
  <div class="relative z-10 max-w-6xl mx-auto p-4 md:p-8">
    <header class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
      <div>
        <h1 class="text-3xl md:text-4xl font-black tracking-tight">Velkzie Music Player</h1>
        <p class="text-neutral-400">YouTube ‚Ä¢ Queue ‚Ä¢ Lyrics ‚Ä¢ Faves ‚Ä¢ Stats ‚Ä¢ History</p>
      </div>
      <div class="flex gap-2 flex-wrap">
        <button id="btnQueue" class="px-3 py-2 rounded-xl bg-neutral-800 hover:bg-neutral-700">üìñ Queue</button>
        <button id="btnLyrics" class="px-3 py-2 rounded-xl bg-purple-700 hover:bg-purple-600">Lyrics</button>
        <button id="btnFaves" class="px-3 py-2 rounded-xl bg-neutral-800 hover:bg-neutral-700">‚≠ê Faves</button>
        <button id="btnStats" class="px-3 py-2 rounded-xl bg-neutral-800 hover:bg-neutral-700">üìä Stats</button>
        <button id="btnHistory" class="px-3 py-2 rounded-xl bg-neutral-800 hover:bg-neutral-700">üìú History</button>
        <button id="btnImport" class="px-3 py-2 rounded-xl bg-neutral-800 hover:bg-neutral-700">üì• Import</button>
        <button id="btnExport" class="px-3 py-2 rounded-xl bg-neutral-800 hover:bg-neutral-700">üì§ Export</button>
        <button id="btnShare" class="px-3 py-2 rounded-xl bg-neutral-800 hover:bg-neutral-700">üîó Share</button>
        <input id="fileImport" type="file" accept="application/json,.json,.lrc,.txt" class="hidden" />
      </div>
    </header>

    <section class="mt-6">
      <input id="youtubeInput" placeholder="Paste YouTube URL here" class="w-full px-4 py-3 rounded-2xl bg-neutral-900 border border-neutral-800 outline-none" />
      <div class="flex gap-2 mt-2">
        <button onclick="addYouTubeToPlaylist()" class="px-4 py-2 rounded-xl bg-red-600 text-white">Add to Queue</button>
        <button id="btnPasteLRC" class="px-4 py-2 rounded-xl bg-neutral-800 hover:bg-neutral-700">Import LRC to Lyrics</button>
      </div>
    </section>

    <section class="mt-6 p-4 rounded-3xl bg-neutral-900/70 border border-neutral-800 shadow-xl backdrop-blur">
      <div class="flex items-center gap-4">
        <img id="coverArt" alt="Cover" class="w-24 h-24 rounded-2xl object-cover bg-neutral-800" />
        <div class="min-w-0 flex-1">
          <div class="flex items-center gap-3">
            <div id="nowTitle" class="text-xl font-bold truncate flex-1">‚Äî</div>
            <button id="btnFavToggle" class="pill">‚≠ê</button>
          </div>
          <div class="text-sm text-neutral-400 mt-1" id="nowInfo">‚Äî</div>
        </div>
      </div>
      <div class="mt-4 flex items-center gap-2 flex-wrap">
        <button id="btnPrev" class="btn-control">‚èÆÔ∏è</button>
        <button id="btnPlay" class="btn-control">‚ñ∂</button>
        <button id="btnNext" class="btn-control">‚è≠Ô∏è</button>
        <button id="btnShuffle" class="btn-control">üîÄ</button>
        <button id="btnRepeat" class="btn-control">üîÅ</button>
      </div>
      <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div><label class="text-sm text-neutral-400">Volume</label><input id="vol" type="range" min="0" max="100" value="100" class="w-full" /></div>
        <div><label class="text-sm text-neutral-400">Speed</label><input id="speed" type="range" min="0.5" max="2" step="0.1" value="1" class="w-full" /></div>
        <div class="flex items-end"><button id="resetSpeed" class="px-3 py-2 rounded-xl bg-neutral-800 hover:bg-neutral-700 w-full">Reset Speed</button></div>
      </div>
      <div id="player"></div>
    </section>
  </div>

  <!-- Lyrics Panel -->
  <div id="lyricsPanel">
    <div class="flex gap-2 mb-3">
      <button id="tabSynced" class="pill">‚è±Ô∏è Synced</button>
      <button id="tabPlain" class="pill">üìÑ Static</button>
      <button id="btnTranslateLyrics" class="pill">üåê Translate</button>
      <button id="btnClearLyrics" class="pill ml-auto">üßπ Clear</button>
    </div>
    <div id="lyricsSynced"></div>
    <div id="lyricsPlain" class="hidden"></div>
  </div>

  <!-- Queue Panel -->
  <div id="queuePanel"></div>

  <!-- History Modal -->
  <div id="modalHistory" class="modal">
    <div class="bg-neutral-900 border border-neutral-800 rounded-2xl p-4 w-[min(92vw,720px)]">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-xl font-bold">üìú Play History</h3>
        <button class="pill" onclick="closeModal('modalHistory')">Close</button>
      </div>
      <div id="historyList" class="space-y-2"></div>
    </div>
  </div>

  <!-- Favorites Modal -->
  <div id="modalFaves" class="modal">‚Ä¶</div>

  <!-- Stats Modal -->
  <div id="modalStats" class="modal">‚Ä¶</div>

  <script>
    // (your existing script code here‚Ä¶)
    // ADD HISTORY SUPPORT
    let history = JSON.parse(localStorage.getItem('velkzieHistory') || '[]');
    function saveHistory(track){
      history.unshift({ id:track.id, title:track.title, cover:track.cover, url:track.url, time:new Date().toLocaleString() });
      history = history.slice(0,50);
      localStorage.setItem('velkzieHistory', JSON.stringify(history));
    }
    function openHistory(){
      const list=document.getElementById('historyList');
      list.innerHTML='';
      if(!history.length){ list.innerHTML='<div class="text-neutral-400">No history yet.</div>'; return; }
      history.forEach(h=>{
        const row=document.createElement('div');
        row.className='flex items-center gap-3 p-2 rounded-xl bg-neutral-800';
        row.innerHTML=`<img src="${h.cover}" class="w-12 h-12 rounded-lg object-cover" />
          <div class="flex-1 min-w-0"><div class="truncate font-semibold">${h.title}</div>
          <div class="text-xs text-neutral-400">${h.time}</div></div>`;
        list.appendChild(row);
      });
      openModal('modalHistory');
    }
    document.getElementById('btnHistory').addEventListener('click',openHistory);

    // MODIFY playTrack to include history save
    const originalPlayTrack = playTrack;
    playTrack = function(i){
      originalPlayTrack(i);
      saveHistory(playlist[i]);
    };

    // LYRIC TRANSLATION
    document.getElementById('btnTranslateLyrics').addEventListener('click', async ()=>{
      const text=[...lyricsPlain.querySelectorAll('.lyric-line')].map(el=>el.textContent).join("\n");
      if(!text.trim()) return alert("No lyrics to translate!");
      try{
        const res=await fetch("https://libretranslate.de/translate",{
          method:"POST", headers:{"Content-Type":"application/json"},
          body:JSON.stringify({ q:text, source:"auto", target:"en" })
        });
        const data=await res.json();
        const lines=data.translatedText.split("\n");
        lyricsPlain.innerHTML=lines.map(line=>`<div class="lyric-line">${line}</div>`).join("");
        tabPlain.click();
      }catch(e){ alert("Translation failed"); console.error(e); }
    });
  </script>
</body>
</html>
