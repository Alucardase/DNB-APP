<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Velkzie Music Player</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
  <style>
    :root { color-scheme: dark; }
    body { background:#0a0a0a; color:white; margin:0; padding:0; }
    .btn-control{background:linear-gradient(270deg,#7e22ce,#9333ea,#a855f7);background-size:600% 600%;color:white;border:none;border-radius:1rem;padding:.75rem 1rem;font-size:1.25rem;animation:gradientMove 6s ease infinite;transition:.2s;}
    .btn-control:hover{box-shadow:0 0 15px rgba(168,85,247,.8);transform:scale(1.05);}
    @keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .pill{padding:.35rem .6rem;border-radius:.75rem;background:#1f1f23;}
    .pill:hover{background:#2a2a30;}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:50;}
    .modal.open{display:flex;}
    #player{position:relative;width:100%;padding-bottom:56.25%;height:0;margin-top:1rem;border-radius:1rem;overflow:hidden;background:#000;}
    #player iframe{position:absolute;top:0;left:0;width:100%;height:100%;}
  </style>
</head>
<body class="p-4">

  <h1 class="text-3xl font-bold">Velkzie Music Player</h1>

  <div class="mt-4">
    <input id="youtubeInput" placeholder="Paste YouTube URL" class="w-full p-2 rounded bg-neutral-900 border border-neutral-800" />
    <button onclick="addYouTubeToPlaylist()" class="mt-2 px-4 py-2 bg-red-600 rounded">Add to Queue</button>
  </div>

  <div class="mt-4 flex gap-2">
    <button id="btnPrev" class="btn-control">‚èÆÔ∏è</button>
    <button id="btnPlay" class="btn-control">‚ñ∂</button>
    <button id="btnNext" class="btn-control">‚è≠Ô∏è</button>
    <button id="btnShuffle" class="btn-control">üîÄ</button>
    <button id="btnRepeat" class="btn-control">üîÅ</button>
  </div>

  <div id="player"></div>

  <script>
    // === State ===
    let playlist = [];
    let current = 0;
    let ytPlayer, ytReady=false;
    let shuffle=false, repeat=false;

    // === YouTube API Init ===
    function onYouTubeIframeAPIReady(){
      ytPlayer = new YT.Player('player',{
        videoId:'',
        playerVars:{autoplay:0,controls:1,modestbranding:1,rel:0},
        events:{
          onReady:()=>ytReady=true,
          onStateChange:(e)=>{
            if(e.data===0){ // ended
              if(repeat) playTrack(current);
              else nextTrack();
            }
          }
        }
      });
    }

    // === Helpers ===
    function getYouTubeId(url){
      try{
        const u=new URL(url);
        if(u.hostname.includes("youtu.be")) return u.pathname.slice(1);
        if(u.searchParams.get("v")) return u.searchParams.get("v");
      }catch{}
      return null;
    }

    // === Add to Queue ===
    async function addYouTubeToPlaylist(){
      const url=document.getElementById('youtubeInput').value.trim();
      const id=getYouTubeId(url);
      if(!id) return alert("Invalid YouTube URL");
      try{
        const res=await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`);
        const data=await res.json();
        const track={id,title:data.title,url:`https://youtu.be/${id}`,cover:data.thumbnail_url};
        playlist.push(track);
        if(playlist.length===1) playTrack(0);
        alert("Added: "+track.title);
      }catch(err){alert("Could not load video");}
    }

    // === Playback ===
    function playTrack(i){
      current=i;
      const t=playlist[i];
      if(ytReady) ytPlayer.loadVideoById(t.id);
      document.getElementById('btnPlay').textContent='‚è∏';
    }
    function nextTrack(){ if(!playlist.length)return; shuffle? playTrack(Math.floor(Math.random()*playlist.length)) : playTrack((current+1)%playlist.length); }
    function prevTrack(){ if(!playlist.length)return; playTrack((current-1+playlist.length)%playlist.length); }

    // === Button Events ===
    document.getElementById('btnPlay').addEventListener('click',()=>{
      if(!ytReady)return;
      const st=ytPlayer.getPlayerState();
      if(st===1){ ytPlayer.pauseVideo(); document.getElementById('btnPlay').textContent='‚ñ∂'; }
      else{ ytPlayer.playVideo(); document.getElementById('btnPlay').textContent='‚è∏'; }
    });
    document.getElementById('btnNext').addEventListener('click',nextTrack);
    document.getElementById('btnPrev').addEventListener('click',prevTrack);
    document.getElementById('btnShuffle').addEventListener('click',()=>shuffle=!shuffle);
    document.getElementById('btnRepeat').addEventListener('click',()=>repeat=!repeat);
  </script>
</body>
</html>
